<!DOCTYPE html>
<meta charset="utf-8">
<html>
{% load static %}
	<head>
		<link rel="stylesheet" type="text/css" href="{% static 'temp/style.css' %}" />
		<link rel="stylesheet" type="text/css" href="{% static 'temp/d3-floorplan/d3.floorplan.css' %}" />
		<script src="http://d3js.org/d3.v3.js"></script>
		<script src="{% static 'temp/d3-floorplan/d3.floorplan.min.js' %}"></script>
		<!--<script src="{% static 'temp/fp.js' %}"></script>-->
	</head>
	<body>
		<h1>Atelier Ten Floorplan Temperature Heatmap</h1>
		{% if sensor_list %}
		    <ul>
		    {% for sensor in sensor_list %}
		        <li>{{ sensor.sensor_name }}</li>
		    {% endfor %}
		    </ul>
		{% else %}
		    <p>No Sensors are available.</p>
		{% endif %}
		<script>
			var xscale = d3.scale.linear()
			               .domain([0,50.0])
			               .range([0,720]),
			    yscale = d3.scale.linear()
			               .domain([0,33.79])
			               .range([0,487]),
			    map = d3.floorplan()
			    	.xScale(xscale)
			    	.yScale(yscale),
			    imagelayer = d3.floorplan.imagelayer(),
			    heatmap = d3.floorplan.heatmap(),
			    vectorfield = d3.floorplan.vectorfield(),
			    pathplot = d3.floorplan.pathplot(),
			    overlays = d3.floorplan.overlays().editMode(true),
			    mapdata = {};

			mapdata[imagelayer.id()] = [{
			    url: "http://dciarletta.github.io/d3-floorplan/Sample_Floorplan.jpg",
			    x: 0,
			    y: 0,
			    height: 33.79,
			    width: 50.0
			     }];

			map.addLayer(imagelayer)
			   .addLayer(heatmap)
			   .addLayer(vectorfield)
			   .addLayer(pathplot)
			   .addLayer(overlays);

			d3.json("{% url 'getdat' %}", function(err, data){
			  if(err) console.log("error fetching data");
			  console.log(data)
			  mapdata[heatmap.id()] = data[0].heatmap;  
			  console.log(data[0].heatmap)  
			  mapdata[overlays.id()] = data[1].overlays;
			  mapdata[vectorfield.id()] = data[2].vectorfield;
			  mapdata[pathplot.id()] = data[3].pathplot;
			   	
			   	d3.select("#demo").append("svg")
			   		.attr("height", 487).attr("width",720)
			   		.datum(mapdata).call(map);
			});
		</script>
		<div id="demo"></div>
	</body>

<html>


<!-- <a href="/temp/{{ sensor.id }}/"> 

url("images/a10fp.png") no-repeat -->	

<!--
var xscale = d3.scale.linear()
               .domain([0,50.0])
               .range([0,720]),
    yscale = d3.scale.linear()
               .domain([0,33.79])
               .range([0,487]),
    map = d3.floorplan().xScale(xscale).yScale(yscale),
    imagelayer = d3.floorplan.imagelayer(),
    heatmap = d3.floorplan.heatmap(),
    vectorfield = d3.floorplan.vectorfield(),
    pathplot = d3.floorplan.pathplot(),
    overlays = d3.floorplan.overlays().editMode(true),
    mapdata = {};

mapdata[imagelayer.id()] = [{
    url: 'http://dciarletta.github.io/d3-floorplan/Sample_Floorplan.jpg',
    x: 0,
    y: 0,
    height: 33.79,
    width: 50.0
     }];

map.addLayer(imagelayer)
   .addLayer(heatmap)
   .addLayer(vectorfield)
   .addLayer(pathplot)
   .addLayer(overlays);

var loadData = function(data) {
   	mapdata[heatmap.id()] = data.heatmap;
   	mapdata[overlays.id()] = data.overlays;
   	mapdata[vectorfield.id()] = data.vectorfield;
   	mapdata[pathplot.id()] = data.pathplot;

   	//console.log(mapdata) // is not null
   	console.log(map)   // is weird 

   	var selection = d3.select("#demo").append("svg")
   		.attr("height", 487)
   		.attr("width",720)
   		.datum(mapdata)
   			.call(map)   // doesn't like this, 
   	console.log(selection)
   	console.log(map)
   	selection.call(data, "map");   // doesn't like this
   };

loadData(jsonData);  // error here loading data
